<!-- Copyright 2012 Google Inc. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
// -->
<!DOCTYPE html>
<title>Unit Test of e2e.packet.PublicKey and PublicSubkey</title>
<script src="../../../../closure/base.js"></script>
<script src="test_js_deps-runfiles.js"></script>
<script>
  goog.require('goog.array');
  goog.require('goog.crypt');
  goog.require('goog.testing.jsunit');
  goog.require('e2e.cipher.Aes');
  goog.require('e2e.cipher.Ecdh');
  goog.require('e2e.cipher.Rsa');
  goog.require('e2e.openpgp.block.factory');
  goog.require('e2e.openpgp.packet.PublicKey');
  goog.require('e2e.openpgp.packet.PublicSubkey');
  goog.require('e2e.openpgp.parse');
  goog.require('e2e.signer.Ecdsa');
</script>
<script>
function testConstructor() {
  var pubkey = new e2e.openpgp.packet.PublicKey(
      0x04, 0,
      new e2e.cipher.Aes(e2e.cipher.Algorithm.AES128,
      {key: goog.array.repeat(0, 16)}));
}

function testParseSerialize() {
  var body = [
    4, 81, 204, 186, 14, 1, 4, 0, 150, 244, 79, 184, 16, 149, 242, 144, 90,
    100, 116, 116, 181, 43, 185, 228, 76, 87, 47, 20, 122, 103, 38, 198, 199,
    72, 31, 125, 63, 30, 162, 111, 168, 238, 177, 83, 73, 74, 53, 161, 109,
    105, 92, 65, 117, 233, 192, 50, 145, 40, 162, 45, 68, 113, 56, 191, 108,
    226, 159, 207, 126, 133, 99, 241, 64, 69, 56, 151, 191, 82, 215, 184, 188,
    197, 37, 211, 242, 141, 54, 35, 135, 187, 112, 250, 227, 143, 82, 82, 201,
    9, 54, 98, 146, 10, 231, 51, 78, 237, 197, 53, 34, 85, 81, 30, 180, 230,
    190, 186, 124, 138, 159, 94, 196, 95, 67, 229, 74, 144, 27, 25, 151, 157,
    200, 237, 39, 27, 5, 243, 0, 17, 1, 0, 1];
  var pubkey = e2e.openpgp.packet.PublicKey.parse(body);
  assertArrayEquals([6, 255, 156, 172, 9, 45, 168, 8], pubkey.keyId);
  var serialized = pubkey.serializePacketBody();
  var parsedAgain = e2e.openpgp.packet.PublicKey.parse(serialized);
  assertArrayEquals([6, 255, 156, 172, 9, 45, 168, 8], parsedAgain.keyId);
}

function testECC() {
  var publicKeyAscii =
    '-----BEGIN PGP PUBLIC KEY BLOCK-----\n' +
    'Version: GnuPG v2.1.0-ecc (GNU/Linux)\n' +
    '\n' +
    'mFIEUh5AoBMIKoZIzj0DAQcCAwT68182duSEJFXKa+qkBa0Vgeswnv8GP8tKYiU/\n' +
    'MCZd6dGTvrtf2gSjyAsVkB0V0idW7i8yW1wfh3y2AbGWDr/dtB9lY2MgcmVhbCBu\n' +
    'YW1lIDxlY2NAZXhhbXBsZS5jb20+iHoEExMIACIFAlIeQKACGwMGCwkIBwMCBhUI\n' +
    'AgkKCwQWAgMBAh4BAheAAAoJEOrrinav6MhnxtcA/iAteDFo/P5SU5XV/8/4BN9x\n' +
    'f28SuvwFipnjjyOmvB0eAP4kPM5LAp2EW+QIyG6+CJP1No9uWyZTdLPkTRgLtYhi\n' +
    'GLhWBFIeQKASCCqGSM49AwEHAgMEgk1dVpgPCM38NBNoBcvehm7mt6aUmK8mDb/M\n' +
    'SHo2/NlwfTh+BDCoVX5asSetzuW2RbnP6sCBwfsuLSrSWUVauwMBCAeIYQQYEwgA\n' +
    'CQUCUh5AoAIbDAAKCRDq64p2r+jIZzqQAQCcv0VOQFiNOM6JNdLHTqlCYxeoz09d\n' +
    'UP3LdgcnLED/YwD9FqcNrkok9BuXJ9+rXTSu+uqdWB7gpMO9mfk65d5IQ+s=\n' +
    '=xRCj\n' +
    '-----END PGP PUBLIC KEY BLOCK-----';
  var publicKeyBlock = e2e.openpgp.block.factory.parseAscii(publicKeyAscii);
  var subKeySerialized = publicKeyBlock.subKeys[0].serializePacketBody();
  var subKey = e2e.openpgp.packet.PublicSubkey.parse(subKeySerialized);
  assertArrayEquals(publicKeyBlock.subKeys[0].fingerprint, subKey.fingerprint);
  assertObjectEquals(
    publicKeyBlock.subKeys[0].cipher.getKey()['pubKey'],
    subKey.cipher.getKey()['pubKey']);
}

</script>
